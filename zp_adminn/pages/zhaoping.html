<div class="main">
	<div class="layui-tab">
	  <ul class="layui-tab-title">
	    <li class="layui-this">招聘中</li>
	    <li>招聘完结</li>
	  </ul>
	  <button type="button" id="btn_add" class="btn btn-primary float-right"  data-target="#exampleModal" data-toggle="modal">
	  发布职位
	 </button>
	  <button type="button" id="btn_return" class="btn btn-primary text-center">
	  返回
	 </button>
	  <div class="layui-tab-content">
	  	<!-- 招聘中内容开始 -->
	    <div class="layui-tab-item layui-show">
	    <!-- 选择 -->
	    	<div class="select">
				 <div class="form-group col-md-2">
				      <select id="inputing" class="form-control select_d">
				     	 
				      </select>
			      </div>
			</div>
	 	<!-- 选择 end-->

	 	<table class="table text-center">
			  <thead class="thead-dark ">
			    <tr>
			      <th scope="col">#</th>
			      <th scope="col">招聘标题</th>
			      <th scope="col">发布人</th>
			      <th scope="col">联系方式</th>
			      <th scope="col">职位</th>
			      <th scope="col">发布时间</th>
			      <th scope="col">详情</th>
			      <th scope="col">操作</th>
			    </tr>
			  </thead>
			  <tbody id="tbodying">
			   
			  </tbody>
			</table>
	    </div>
	  	<!-- 招聘中内容结束 -->

	  	<!-- 招聘完结内容开始 -->
	    <div class="layui-tab-item">
	    	<!-- 选择-->
	    	<div class="select">
				 <div class="form-group col-md-2">
				      <select id="inputedd" class="form-control select_d">
				     	
				      </select>
			      </div> 
			</div>
			<!-- 选择 end-->
			<table class="table text-center">
			  <thead class="thead-dark ">
			    <tr>
			      <th scope="col">#</th>
			      <th scope="col">招聘标题</th>
			      <th scope="col">发布人</th>
			      <th scope="col">联系方式</th>
			      <th scope="col">职位</th>
			      <th scope="col">发布时间</th>
			      <th scope="col">详情</th>
			      <th scope="col">状态</th>
			    </tr>
			  </thead>
			  <tbody id="tbodyed">
			   
			  </tbody>
			</table>
	    </div>
	  	<!-- 招聘完结内容结束 -->
	 	
	  </div>
	</div>
	<div class="modal fade bd-example-modal-lg" id="exampleModal">
	  <div class="modal-dialog modal-lg" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title" id="exampleModalLabel">修改招聘</h5>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body">
	       	<!-- 表单开始 -->
	       	<form>
	       	<input type="hidden" id="id">
			  <div class="form-group row">
			    <label for="inputname" class="col-form-label col-2">兼职名称</label>
			    <div class="col-4">
			      <input type="text" class="form-control" id="inputname" placeholder="兼职名称">
			    </div>

			    <label for="inputnum" class="col-2 col-form-label text-center">招聘人数</label>
			    <div class="col-4">
			    	<input type="text" class="form-control" id="inputnum" placeholder="人数">
			    </div>
			  </div>
			  <div class="form-group row">
			    <label for="inputclass" class="col-2 col-form-label ">选择工种</label>
			    <div class="col-4">
				     <select name="" id="inputclass" class="form-control">
				     	
				     </select>
				 </div>
		    	<label for="inputcompany" class="col-2 col-form-label text-center">招聘公司</label>
			    <div class="col-4">
				     <select name="" id="inputcompany" class="form-control">
				     	
				     </select>
				 </div>
			  </div>

			   <div class="form-group row">
				    
			    	<label for="inputmoney" class="col-2 col-form-label">薪资水平</label>
				    <div class="col-4">
					     <input type="text" class="form-control" id="inputmoney" placeholder="薪资">
				    </div>
			
			    <label for="inputjob" class="col-2 col-form-label text-center">职位标签</label>
			    <div class="col-4">
			      <input type="text" class="form-control" id="inputjob" placeholder="五险一金">
			    </div>
			  </div>
			  <div class="form-group row">
				 <label for="inputstatus" class="col-2 col-form-label">职位状态</label>
			    <div class="col-4">
				     <select name="" id="inputstatus" class="form-control">
				     	<option value="招聘中" selected>招聘中</option>
				     	<option value="招聘完结">招聘完结</option>
				     </select>
				 </div>

			    <label for="inputdiscription" class="col-2 col text-center">职位描述</label>
			    <div class="col-4">
			      <textarea type="text" class="form-control" id="inputdiscription" placeholder="描述">
			      </textarea>
			    </div>


			  </div>
			</form>
	       	<!-- 表单结束 -->
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
	        <button type="button" class="btn btn-primary btn_input">Save changes</button>
	      </div>
	    </div>
	  </div>
	</div>
	<!-- 表单结束 -->
</div>

<!-- 详情表单 -->
<!-- 表单 -->
<div class="modal fade" id="moreModal">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
       <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
       	<!-- 表单开始 -->
		<div class="row">
			<h3 class="inline-block col-9" id="moretitle"></h3>
       		<h3 id="modalsalary" class="text-warning col-3 text-right inline-block"></h3>
		</div>
       	<div class="border-bottom"></div>
       	<div class="" id="modald"></div>
        <div class="d-block" id="modalscale"></div>
		
       	<div>
       		<div class="btn inline-block mb-3">
       			<span>招</span>
	       		<span id="modalnum"></span>
	       		<span>人</span>
       		</div>
       	
       		<div class="inline-block btn">
       			<span id="modaleworkingHours"></span>
       		</div>
       	
       	</div>
       	<div>
       		<span  class="fa fa-map-marker mr-2"></span><span id="modalprovince"></span><span id="modalcity"></span>
       	</div>
       	<div class="row mb-3 mt-3">
       		<div id="modalwelfare" class="ml-3 col-8 nb-2"></div>
       		<div id="modalcompany" class="col-4 text-right"></div>
       	</div>
       	<div class="border-bottom"></div>
       	<h4>职位描述</h4>
       	<div id="modaldescription" class="h-100"></div>
		<div class="border-bottom"></div>
		
       	<!-- 表单结束 -->
      </div>
    </div>
  </div>
</div>
<style>
	.modal-backdrop{
		z-index: -1;
	}
	.modal{
		margin-top: 60px;
	}
	#btn_add{
		margin-right: 20px;
	}
	#btn_return{
		display: none;
		float: right;
		margin-right: 20px;
	}
</style>
<script>
// 清除重复的值
function clearaa(arr){
	arr.forEach(function(item,index){
		for(var i=index+1;i<arr.length;i++){
			if(item==arr[i]){
				arr.splice(i,1);
					
				i--;
			}
		}
	// }
	})
}

function jobcompany(){
	var baseURL="http://203.195.246.58:7777";
	//在查询商家接口获取招聘的公司的数据并放入select中
					$("#inputcompany").empty();
					$("#inputclass").empty();
					var url=baseURL+"/Business/findAll";
					$.get(url,function(response){
						var arr_company=[];
						response.data.forEach(function(item,index){
							if(item.status=="审核通过"){
								arr_company[index]=item.name
							}
							// $(`<option value="">`+item.name+`</option>`).appendTo($("#inputcompany"))
							
							clearaa(arr_company);
						})
						// console.log(arr_company)
					for(var i=0;i<arr_company.length;i++){
						if(arr_company[i]!=undefined){
							$(`<option value="`+arr_company[i]+`">`+arr_company[i]+`</option>`).appendTo($("#inputcompany"))
					}
				}

					})
				//在查询职位接口获取招聘的职位的数据并放入select中
				var url2=baseURL+"/Jobs/findAll";
				$.get(url2,function(response){

						var arr_job=[]
						response.data.forEach(function(item,index){
							// console.log(item);
							// $(`<option value="">`+item.name+`</option>`).appendTo($("#inputcompany"))
							arr_job[index]=item.name
							clearaa(arr_job);
						})
						// console.log(arr_job)
					for(var i=0;i<arr_job.length;i++){
						if(arr_job[i]!=undefined){
							$(`<option value="`+arr_job[i]+`">`+arr_job[i]+`</option>`).appendTo($("#inputclass"))
					}
				}

			})
}
	$(function(){
		//时间处理
		var dateParse=(dataString)=>{
		  if(dataString){
		    let date = new Date(dataString);
		    let Y = date.getFullYear() + '-';
		    let M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
		    let D = (date.getDate()< 10 ? '0'+date.getDate() : date.getDate())+' ';
		    let h = (date.getHours()< 10 ? '0'+date.getHours() : date.getHours())+ ':';
		    let m = (date.getMinutes()< 10 ? '0'+date.getMinutes() : date.getMinutes())+ ':';
		    let s = (date.getSeconds()< 10 ? '0'+date.getSeconds() : date.getSeconds());
		    return Y+M+D+h+m+s;
		  }else{
		    return '';
		  }
		}

		//处理结束

		var baseURL="http://203.195.246.58:7777";
		function reload(){
			var url=baseURL+"/Employment/findAll";
			$.get(url,function(response){
				$("tbody").empty();
				$(".select select").empty();
				
				var arring=[];
				var arred=[];
				response.data.forEach(function(item,index){
				// console.log(item);	
				if(item.auditStatus=="审核通过"){
					if(item.status=="招聘中"){
						$(` <tr>
						    	<td> <input type="checkbox" value="`+item.id+`"> </td>
						    	<td class="name">`+item.title+`</td>
						    	<td class="contactName">`+item.contactName+`</td>
						    	<td class="contactPhone">`+item.contactPhone+`</td>
						    	<td class="job">`+item.job+`</td>
						    	<td class="publishTime">`+dateParse(item.publishTime)+`</td>
						    	<td> <a href="#" class="more" data-target="#moreModal" data-toggle="modal">详情</a></td>
						    	<td><span><i class="fa fa-pencil-square-o" aria-hidden="true" data-toggle="modal" data-target="#exampleModal"></i></span><span><i class="fa fa-trash" aria-hidden="true"></i></span></td>
						    </tr>`).appendTo($("#tbodying"));
						arring[index]=item.job
						arring.forEach(function(item,index){
							for(var i=index+1;i<arring.length;i++){
								if(item==arring[i]){
									arring.splice(i,1);
										
									i--;
								}
							}
						
						})
					}else{
						$(` <tr>
						    	<td> <input type="checkbox" value="`+item.id+`"> </td>
						    	<td>`+item.title+`</td>
						    	<td>`+item.contactName+`</td>
						    	<td>`+item.contactPhone+`</td>
						    	<td>`+item.job+`</td>
						    	<td>`+dateParse(item.publishTime)+`</td>
						    	<td> <a href="#" class="more" data-target="#moreModal" data-toggle="modal">详情</a></td>
						    	<td class="text-warning">`+item.status+`</td>
						    </tr>`).appendTo($("#tbodyed"));
						arred[index]=item.job
						// for(var j=0;j<arred.length;j++){
							arred.forEach(function(item,index){
							for(var i=index+1;i<arred.length;i++){
								if(item==arred[i]){
									arred.splice(i,1);
										
									i--;
								}
							}
						// }
						})
							

					}
				}
				})
				// console.log(arred.length)
				for(var i=0;i<arred.length;i++){
					if(arred[i]!=undefined){
						$(`<option value="`+arred[i]+`">`+arred[i]+`</option>`).appendTo($("#inputedd"))
					}
				}
				for(var i=0;i<arring.length;i++){
					if(arring[i]!=undefined){
						$(`<option value="`+arring[i]+`">`+arring[i]+`</option>`).appendTo($("#inputing"))
					}
				}
			})
		}
		reload();
		//事件代理
		$("tbody").on("click","i",function(){
			// 删除
			// console.log(this);
			switch(this.className){
				
				case "fa fa-trash":var url=baseURL+"/Employment/deleteById";
					var data={
						id:$(this).parents("tr").children().eq().find("input").val()
					}
					// console.log(data)
					$.post(url,data,function(response){
						if(response.status==200){
							reload();
							alert(response.message);
						}else{
							console.log(response);
						}

					})
					
					break;

				case "fa fa-pencil-square-o":
					var id=$(this).parents("tr").children()[0].firstElementChild.value
					$("#id").val($(this).parents("tr").children()[0].firstElementChild.value)
					$("#inputname").val($(this).parents("tr").children(".name").text())
					jobcompany();
					var url=baseURL+"/Employment/findAll";
					$.get(url,function(response){
						response.data.forEach(function(item){
							if(item.id==id){
								if(item.auditStatus=="审核通过"){
									$("#inputnum").val(item.num);
									// console.log(item.num)
									$("#inputmoney").val(item.salary);
									$("#inputdiscription").val(item.description);
									$("#inputjob").val(item.welfare);
									$("#inputcompany").val(item.businessId);
									$("#inputclass").val(item.job);
								}
							}
						})
					})

			}
		})

		// 提交

		$(".btn_input").on("click",function(){
			var id=$("#id").val();
			// console.log(id);
			var name=$("#inputname").val();
			var status=$("#inputstatus").val();
			var num=$("#inputnum").val();
			var salary=$("#inputmoney").val();
			var welfare=$("#inputjob").val();
			var description=$("#inputdiscription").val();
			var job=$("#inputclass").val();
			var business=$("#inputcompany").val();
			// console.log(business)
			var url1=baseURL+"/Business/findAll";
			$.get(url1,function(response){
				// var arr_bus
				response.data.forEach(function(item,index){
					// arr_bus[index]=item.name;
					switch(business){
					case item.name:
					console.log(business);
					console.log(item.name);
						if(id){
							
							var data={
								id:id,
								title:name,
								status:status,
								num:num,
								salary:salary,
								welfare:welfare,
								description:description,
								job:job,
								businessId:item.id,
								auditStatus:"",
								workingHours:24,
								contactName:"马云",
								contactPhone:"自己去问",
								}
					}else{
						// console.log(item.name)
						var data={
						
						title:name,
						status:status,
						num:num,
						salary:salary,
						welfare:welfare,
						description:description,
						job:job,
						businessId:item.id,
						auditStatus:"",
						workingHours:24,

						contactName:"马云",
						contactPhone:"自己去问",
						}
					}
					var url=baseURL+"/Employment/saveOrUpdate "
					$.post(url,data,function(response){
						if(response.status==200){
							// console.log(response)
						}else{
							console.log(response)
						}
						reload();
					});

					break;
					default :console.log("不存在该公司");
				}
						
					
				})
				 // clearaa(arr_bus);
			})
			// console.log(businessId);
			// var data={
			// }

			
		$("#exampleModal").css("display","none");
		})
		// 发布职位
		$("#btn_add").on("click",function(){
			$("#id").val("");
			$("#inputname").val("");
			$("#inputnum").val("");
			$("#inputmoney").val("");
			$("#inputjob").val("");
			$("#inputdiscription").val("");
			$("#inputclass").val("");
			$("#inputcompany").val("");
			jobcompany();
			
		})

	// 模糊查询
	$(".select_d").on("click","option",function(){
	
		$("#btn_return").css("display","block")
		var url=baseURL+"/Employment/findByJob"
		var data={
			job:$(this).val(),
		}
		$.get(url,data,function(response){
			$("tbody").empty();
			response.data.forEach(function(item,index){
				// console.log(item);
				if(item.auditStatus=="审核通过"){	
				if(item.status=="招聘中"){
						$(` <tr>
						    	<td> <input type="checkbox" value="`+item.id+`"> </td>
						    	<td class="name">`+item.title+`</td>
						    	<td class="contactName">`+item.contactName+`</td>
						    	<td class="contactPhone">`+item.contactPhone+`</td>
						    	<td class="job">`+item.job+`</td>
						    	<td class="publishTime">`+item.publishTime+`</td>
						    	<td> <a href="#">详情</a></td>
						    	<td><span><i class="fa fa-pencil-square-o" aria-hidden="true" data-toggle="modal" data-target="#exampleModal"></i></span><span><i class="fa fa-trash" aria-hidden="true"></i></span></td>
						    </tr>`).appendTo($("#tbodying"));
						
						
					}else{
						$(` <tr>
						    	<td> <input type="checkbox" value="`+item.id+`"> </td>
						    	<td>`+item.title+`</td>
						    	<td>`+item.contactName+`</td>
						    	<td>`+item.contactPhone+`</td>
						    	<td>`+item.job+`</td>
						    	<td>`+item.publishTime+`</td>
						    	<td> <a href="#">详情</a></td>
						    	<td class="text-warning">`+item.status+`</td>
						    </tr>`).appendTo($("#tbodyed"));
					}
				}
				})
		})
	})
	$("#btn_return").on("click",function(){
		reload();
		$("#btn_return").css("display","none")
	})

	//详情
		$("tbody").on("click","a",function(){
			// console.log(this);
			if(this.className=="more"){
				var id=$(this).parents("tr").children().eq(0).find("input").val();
				var data={
					id:id,
				}
				var url=baseURL+"/Employment/findById";
				$.get(url,data,function(response){
					console.log(response.data);
					$("#moretitle").text(response.data.title);
					$("#modalsalary").text(response.data.salary);
					$("#modalnum").text(response.data.num)
					$("#modalworkingHours").text(response.data.workingHours);
					$("#modalprovince").text(response.data.province)
					$("#modaldescription").text(response.data.description);
					$("#modalwelfare").text(response.data.welfare);
					$("#modalcity").text(response.data.city);
					$("#modalcompany").text(response.data.name)
				})
				
			}
			
		})

	})

</script>